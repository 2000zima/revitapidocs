{% extends "base.html" %}

<!-- Rendered tempaltes must include header() macro#} -->
{% from '%s' % content import header %}
{% block header %}
    {{ header() }}
{% endblock %}

{% block content %}

    <div class="col-sm-12 col-md-4 col-lg-3" id="sidebar">


        {# Add menu for the correct year #}
        {# {% include '%s' % ns_template with context %}#}
        <div class="form-group" id="sidebarsearch">
        <label class="control-label">Quick Search</label>
          <div class="input-group input-group-sm">
            <input type="text" class="form-control">
              <span class="input-group-btn">
                <button class="btn btn-default" type="button">Search</button>
              </span>
          </div>
        </div>

        <span id="menu-loading" class="small text-muted"><img src="{{ url_for('static', filename="img/loader.gif") }}">
        &nbsp;Loading</span>
        <div id="treeview"></div>

        {# Add Google Search Box #}
        {#{% include 'google_search.html' %}#}

    </div>

    <div class="col-sm-12 col-md-8 col-lg-9" id="main">
        {% if active_ul and available_in%}
            <div id='alsofor'>
                <p class="small"><small>
                    API VERSIONS |
                    {% for year in available_in %}
                    <a href="/{{year}}/{{active_ul}}"> {{year}} </a>
                    {% endfor %}
                </small></p>
            </div>
        {%endif%}

        {% include '%s' % content %}
        <hr />
        {# <div class="comment-bar">#}
        {% include 'disqus.html' %}
        {# </div>#}
    </div>

{% endblock %}

{% block script %}
    {# This script is added here because it usus the active_ul variable#}
    <script>
    // $( document ).ready(function() {
    //     var active_ul = "{{active_ul}}";
    //     var active_ul_tag = $('a[href$="{{active_ul}}"]');
    //
    //     active_ul_tag.parentsUntil('ul.Collapsible', 'ul').each(function(){
    //         // console.log(this)
    //         $(this).show();
    //         $(this).children('li').toggleClass("open closed");
    //         // $(this).children('li').css('font-weight','bold');
    //         $(this).parents('li').toggleClass("active");
    //         // $(this).css('font-weight','bold');
    //         $(this).siblings('ul').show(); // Revel Syster  ULs
    //     });
    //
    //     active_ul_tag.parents('li').toggleClass("open closed");
    //     active_ul_tag.parents('li').toggleClass("active");
    // });

    var string_json
    $.getJSON("tree.json", function(json) {
        string_json = JSON.stringify(json);
        buildMenu()
    });


    function buildMenu() {

        var $searchableTree = $('#treeview').treeview({
              expandIcon: "glyphicon glyphicon-stop",
            //   expandIcon: "glyphicon glyphicon-stop",
              collapseIcon: "glyphicon glyphicon-unchecked",
            //   emptyIcon: "glyphicon",
              showBorder: false,
              levels: 1,
              enableLinks: true,
              onhoverColor: '#fff',
              backColor: '#eee',
              data: string_json,
            });

        // https://github.com/jonmiles/bootstrap-treeview
        var activeNodeId = parseInt($.cookie("activeNodeId"))
        console.log(activeNodeId)
        $('#treeview').treeview('revealNode', [ activeNodeId, { silent: false } ]);
        $('#treeview').treeview('toggleNodeExpanded', [ activeNodeId, { silent: false } ]);
        var active_ul = "{{active_ul}}";
        var active_ul_tag = $('.node-treeview a[href$="{{active_ul}}"]').parents('li');
        var activeNodeId = active_ul_tag.attr('data-nodeid')
        // var activeNode = $('#treeview').treeview('getNode', activeNodeId);
        $('#treeview').treeview('toggleNodeSelected', [ activeNodeId, { silent: false } ]);

        console.log(active_ul)
        console.log(active_ul_tag)
        console.log(activeNodeId)
        console.log(activeNode)


        $('#menu-loading').animate({opacity: 0},250);
        $('#menu-loading').remove();

        // Sets nodeId as cookie on expand
        $('#treeview').on('nodeExpanded', function(event, node) {
            var activeNodeId = node.nodeId
            $.cookie("activeNodeId", activeNodeId);
        });

    };

    $( document ).ready(function() {

    });

    </script>

{% endblock %}
