{% extends "_base.html" %}

{% block header %}
    <title>Revit API Docs - Code Samples</title>
{% endblock %}

{% block content %}
<div class="col-sm-12 col-md-12 col-lg-12" id="content-full-width">
    <h4>Revit API Code Samples <span class="text-muted small"> BETA</span></h4>
    <hr />
    <p class="small">As the official documentation lacks Python coverage, I thought it would be helpful to include some examples and snippets alongside it.</p>
    <p class="small">The code below should work with <a href="https://github.com/architecture-building-systems/revitpythonshell">RevitPythonShell</a>
    and <a href="https://github.com/eirannejad/pyRevit">pyRevit</a>, but can be also be used within Dynamo with minor tweaks.</p>
    <p class="small">For a more comprehensive set of examples of Python interacting with the Revit API, check out the <a href="https://github.com/eirannejad/pyRevit">pyRevit Repository</a>,
    <a href="http://revitpythonwrapper.readthedocs.io">RevitPythonWrapper</a>,
    <a href="https://daren-thomas.gitbooks.io/scripting-autodesk-revit-with-revitpythonshell/content/deploying_rpsaddins/what_is_a_rpsaddin.html">Revit Python Shell Git Book</a>,
    or some of the links in the <a href="/">main page.</a></p>
    <p class="small">Code is hosted on <a href="https://gist.github.com/gtalarico/">gist.github.com</a>.</p>

    <br />

    <div id="code-injection">
        <img src="{{ url_for('static', filename="img/loader.gif") }}">&nbsp;Loading'
    </div>


    <!-- ERROR PANEL -->
    <div class="panel panel-danger margin-top" id="github-error" style="display:none;">
      <div class="panel-heading">Damn</div>
        <div class="panel-body">
        <p>Something went wrong requesting the latest code snippets.</p>
        <p>Please report this message on our <a href="https://www.github.com/gtalarico/revitapidocs/issues">Github Issues Page</a>.</p>
        <p> Error Info: </p>
        <p><span class="small text-muted"></span></p>
      </div>
    </div>
    <!-- END ERROR PANEL -->


{% raw %}
<script id="repo-code-template" type="text/x-handlebars-template">

    <ul class="nav nav-tabs">
    {{#each folders}}
        <li class="{{#if @first}}active{{/if}}"><a href="#{{name}}" data-toggle="tab" aria-expanded="{{#if @first}}true{{else}}false{{/if}}">{{name}}</a></li>
    {{/each}}
    <!-- <li class="active"><a href="#CSharp" data-toggle="tab" aria-expanded="true">CSharp</a></li> -->
    </ul>


    <div class="panel panel-default">
      <div class="panel" role="tabpanel">
        <div class="panel-body">

            <div id="myTabContent" class="tab-content">

                        {{#each folders}}
                        <div class="tab-pane fade {{#if @first}}active in{{/if}}" id="{{name}}">
                          <p>id: {{name}}</p>


                            <div class="row"> <!--  ROW -->
                                {{#each contents}}
                                <div class="col-sm-12 col-md-6 col-lg-6">
                                    <br/>
                                    <h4>{{ @key }}</h4>
                                    <hr />
                                    <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="false">
                                    {{#each this}}
                                          <div class="panel panel-default" id="{{ id }}">
                                            <div class="panel-heading" role="button" id="heading{{@../../index}}-{{@../index}}-{{@index}}"  data-toggle="collapse" data-parent="#accordion" href="#collapse{{@../../index}}-{{@../index}}-{{@index}}" aria-expanded="true" aria-controls="collapse{{@../../index}}-{{@../index}}-{{@index}}">
                                              <h5 class="panel-title">
                                                  {{ name }}
                                              </h5>
                                            </div>
                                            <div id="collapse{{@../../index}}-{{@../index}}-{{@index}}" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading{{@../../index}}-{{@../index}}-{{@index}}">
                                              <div class="panel-body gist-panel">
                                                {{ data.html_url }}
                                              </div>
                                            </div>
                                          </div>
                                    {{/each}}
                                    </div>
                                </div>
                                {{/each}}
                            </div> <!--  ROW -->

                        </div>
                        {{/each}}


            </div>

        </div>
      </div>
    </div>

</script>
{% endraw %}

    <!-- ADSENSE -->
    {#
    <div class="row"> <!--  ROW -->
        <div class="col-sm-12 col-md-6 col-lg-6">
        {% include 'components/__adsense.hmlt' %}
        </div>
    </div>
    #}
    <!-- END ADSENSE -->
    <!-- DISQUS -->
    {% include 'components/__disqus.html' %}
    <!-- DISQUS -->

</div>

{% endblock %}

{% block script %}

<!-- INSIGHTS HB JS TEMPLATE -->
{# include 'components/__codepanel.html' #}
<!-- INSIGHTS HB JS TEMPLATE -->

<script>

//////////////////////////////////////////////////////////////
// Send Panel Click to Google Analytics, and create URL state
//////////////////////////////////////////////////////////////
// $('.panel-heading').on('click', function(event){
    // var gist_id = $(this).parent().attr('id')
    // ga('send', 'pageview', '/python/#' + gist_id);
    // history.pushState(null, null, '#' + gist_id);
// })

//////////////////////////////////////////////////////////////
// Restore Panel from URL State
//////////////////////////////////////////////////////////////
// function check_panel_url(){
//
//   var state = urlHelper.getState()
//   if (state && state.length > 0) {
//       var panelId = state[0]
//   }
//   if(panelId) {
//       console.log('Has Panel:' + panelId)
//       var $panel = $(panelId).children('.panel-collapse')
//       $panel.collapse('show')
//       var $parent = $('#content-full-width')
//       scrollHelper($parent, $panel, true, 100)
//   }
// };


$(document).ready(function() {
    // check_panel_url()

    var url = "/api/code"

    var response
    var ajaxCode = $.getJSON(url, function(json) {
        response  = json
    })

    ajaxCode.done(function() {
        injectCode(response)
    })


});

function injectCode(response) {
    console.log(response)

    if (response.error) {
        var $githubError = $('#github-error')
        $githubError.show()
        $githubError.find('span').html(response.error)

        // flashAlert(response.error[0])
    }


    if (response.folders) {
        var source  = $("#repo-code-template").html();
        var template = Handlebars.compile(source);
        var html = template(response);
        $('#code-injection').html(html)
    }
    else {
        $('#code-injection').html('')
        var $githubError = $('#github-error')
        $githubError.show()
        $githubError.find('span').html(response.error)
    }

    // $('.alert').hide()

}


</script>
{% endblock %}
